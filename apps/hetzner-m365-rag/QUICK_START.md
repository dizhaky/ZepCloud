# M365 RAG System - Quick Start Guide

## Current Status: Ubuntu Installation In Progress

An elevated PowerShell window is installing Ubuntu for WSL2. This is the recommended approach for local development.

---

## Option 1: Complete WSL2 Setup (RECOMMENDED - In Progress)

### After Ubuntu Installation Completes

1. **Complete Ubuntu Setup**
   - A Ubuntu terminal will open automatically
   - Create a username (lowercase, no spaces)
   - Create a password (you won't see it as you type)
   - Wait for "Installation successful" message

2. **Run Automated Deployment**
   ```powershell
   cd C:\Dev\ZepCloud\apps\hetzner-m365-rag
   .\scripts\deploy-manager.ps1
   ```

3. **The script will automatically:**
   - Copy project to WSL2
   - Install Docker in Ubuntu
   - Generate SSL certificates
   - Start all services
   - Show you access URLs

4. **Access Your System**
   - API: http://localhost:8000
   - Docs: http://localhost:8000/docs
   - RAGFlow: http://localhost
   - Grafana: http://localhost:3000

**Estimated Time:** 15-20 minutes total

---

## Option 2: Docker Desktop (FASTER ALTERNATIVE)

If you want to deploy NOW without waiting for Ubuntu:

### 1. Install Docker Desktop

```powershell
# Download and install
Start-Process "https://desktop.docker.com/win/stable/Docker%20Desktop%20Installer.exe"
```

Or visit: https://www.docker.com/products/docker-desktop

### 2. After Docker Desktop Starts

```powershell
cd C:\Dev\ZepCloud\apps\hetzner-m365-rag

# Generate certificates
bash scripts/generate-es-certs.sh

# Start all services
docker-compose up -d

# Check status
docker-compose ps
```

### 3. Access URLs
- API: http://localhost:8000
- Docs: http://localhost:8000/docs  
- RAGFlow: http://localhost
- Grafana: http://localhost:3000

**Estimated Time:** 5-10 minutes

---

## Option 3: Deploy to Hetzner Server

If you have a Hetzner AX52 server ready:

### 1. Configure Environment
```powershell
# Edit .env with your credentials
notepad .env
```

Required variables:
- `M365_CLIENT_ID`
- `M365_CLIENT_SECRET`
- `M365_TENANT_ID`
- `OPENAI_API_KEY`

### 2. Transfer to Server
```powershell
# Create deployment package
Compress-Archive -Path * -DestinationPath m365-rag-deploy.zip

# Transfer to server (replace YOUR_SERVER_IP)
scp m365-rag-deploy.zip root@YOUR_SERVER_IP:/tmp/
```

### 3. Deploy on Server
```bash
# SSH to server
ssh root@YOUR_SERVER_IP

# Extract and deploy
cd /opt
unzip /tmp/m365-rag-deploy.zip -d m365-rag
cd m365-rag
chmod +x scripts/deploy.sh
./scripts/deploy.sh
```

**Estimated Time:** 30-40 minutes

---

## Configuration Required (All Options)

Before deployment works, edit `.env` file:

```bash
# Microsoft 365 Authentication
M365_CLIENT_ID=your-azure-app-client-id
M365_CLIENT_SECRET=your-azure-app-client-secret
M365_TENANT_ID=your-azure-tenant-id

# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key

# Security (already generated)
ELASTIC_PASSWORD=<auto-generated>
GRAFANA_PASSWORD=<auto-generated>
```

### Get M365 Credentials:
1. Go to https://portal.azure.com
2. Navigate to "Azure Active Directory" â†’ "App registrations"
3. Create new app or use existing
4. Copy: Application (client) ID, Directory (tenant) ID
5. Create client secret under "Certificates & secrets"

### Get OpenAI API Key:
1. Go to https://platform.openai.com
2. Navigate to API keys
3. Create new secret key

---

## Troubleshooting

### Ubuntu Installation Issues
```powershell
# Check WSL status
wsl --status

# List distributions
wsl --list --verbose

# If stuck, try manual install
wsl --install -d Ubuntu
```

### Docker Issues
```powershell
# Check Docker is running
docker version

# Restart Docker Desktop
Get-Process "Docker Desktop" | Restart-Service

# View logs
docker-compose logs -f
```

### Service Health Checks
```bash
# Check all services
docker-compose ps

# Check specific service logs
docker-compose logs elasticsearch
docker-compose logs api
docker-compose logs ragflow

# Restart specific service
docker-compose restart api
```

---

## Next Steps After Deployment

1. **Test API Health**
   ```bash
   curl http://localhost:8000/health
   ```

2. **Authenticate M365**
   ```bash
   curl -X POST http://localhost:8000/m365/auth
   ```

3. **Run Test Search**
   ```bash
   curl -X POST http://localhost:8000/search \
     -H "Content-Type: application/json" \
     -d '{"query": "test", "top_k": 5}'
   ```

4. **Access RAGFlow UI**
   - Open browser: http://localhost
   - Create admin account
   - Upload test document

5. **Monitor System**
   - Grafana: http://localhost:3000
   - Username: admin
   - Password: (check .env file)

---

## Need Help?

- Full documentation: `DEPLOY_NOW.md`
- Architecture details: `docs/ARCHITECTURE.md`
- M365 setup: `docs/M365_INTEGRATION.md`
- Troubleshooting: `docs/TROUBLESHOOTING.md`

---

## Recommended: Option 1 (WSL2)

Wait for Ubuntu installation to complete, then run:
```powershell
.\scripts\deploy-manager.ps1
```

This provides the best development experience and is fully automated.



